<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro Motor Widget</title>
    <style>
        :root {
            --bg: #ffffff;
            --track: #f1f5f9;
            --text: #475569;
            --blue: #3b82f6;
            --red: #ef4444;
            --shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        body {
            background-color: #e2e8f0; /* 仅为了演示对比 */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        /* --- 核心组件容器 (Micro Size) --- */
        .micro-widget {
            width: 220px;  /* 极窄宽度 */
            background: var(--bg);
            border-radius: 8px;
            padding: 10px;
            box-shadow: var(--shadow);
            border: 1.5px solid transparent;
            transition: all 0.3s;
            user-select: none;
            position: relative;
        }

        /* 呼吸警示：解锁时边框变红 */
        .micro-widget.armed {
            border-color: var(--red);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.2);
            animation: breathe 2s infinite;
        }
        @keyframes breathe {
            50% { box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); }
        }

        /* 顶部标题栏 (可点击切换状态) */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
        }
        .title {
            font-size: 10px;
            font-weight: 800;
            color: #94a3b8;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .status-badge {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            background: #f1f5f9;
            color: #94a3b8;
            font-weight: 700;
        }
        .micro-widget.armed .status-badge {
            background: var(--red);
            color: white;
        }

        /* 电机排列区 */
        .motors-grid {
            display: flex;
            justify-content: space-between;
            gap: 4px;
            height: 80px; /* 高度定死 */
        }

        /* 单个电机列 */
        .motor-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        }

        /* 微型螺旋桨 */
        .micro-prop {
            width: 14px;
            height: 14px;
            opacity: 0.2;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23000' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 12c0-3 2.5-5 5-5 3 0 5 2 5 5 0 3-2 5-5 5-2.5 0-5-2-5-5z'/%3E%3Cpath d='M12 12c0 3-2.5 5-5 5-3 0-5-2-5-5 0-3 2-5 5-5 2.5 0 5 2 5 5z'/%3E%3C/svg%3E");
            background-size: cover;
            margin-bottom: 4px;
        }
        .motor-col.spinning .micro-prop { opacity: 1; animation: spin 0.2s linear infinite; }

        /* 进度条槽 */
        .bar-track {
            flex: 1; /* 占满剩余高度 */
            width: 100%;
            background: var(--track);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: flex-end; /* 让序号沉底 */
        }

        /* 进度条填充 */
        .bar-fill {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 0%;
            background: var(--blue);
            border-radius: 2px;
            transition: height 0.1s, background-color 0.2s;
            z-index: 1;
            opacity: 0.8;
        }

        /* 电机序号 (巧妙地放在槽底) */
        .motor-id {
            z-index: 2; /* 在条之上 */
            font-size: 9px;
            font-weight: 800;
            color: rgba(0,0,0,0.3); /* 半透明黑，保证在浅色背景可见 */
            margin-bottom: 2px;
            pointer-events: none;
            mix-blend-mode: multiply; /* 混合模式，让它看起来像刻进去的 */
        }

        /* PWM 数值 */
        .pwm-val {
            font-family: 'Consolas', monospace;
            font-size: 9px;
            color: var(--text);
            margin-top: 3px;
            font-weight: 600;
        }

        /* 隐形滑块 (用于Demo) */
        .demo-slider {
            position: absolute; bottom: -20px; left: 0; width: 100%; opacity: 0.5;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="micro-widget" id="widget" title="点击标题栏模拟解锁">
        <div class="header" onclick="toggleArm()">
            <div class="title">Motor Outputs</div>
            <div class="status-badge" id="badge">DISARMED</div>
        </div>

        <div class="motors-grid">
            <div class="motor-col" id="m1">
                <div class="micro-prop"></div>
                <div class="bar-track">
                    <div class="bar-fill"></div>
                    <span class="motor-id">M1</span>
                </div>
                <div class="pwm-val">1000</div>
            </div>
            <div class="motor-col" id="m2">
                <div class="micro-prop" style="transform: scaleX(-1)"></div>
                <div class="bar-track">
                    <div class="bar-fill"></div>
                    <span class="motor-id">M2</span>
                </div>
                <div class="pwm-val">1000</div>
            </div>
            <div class="motor-col" id="m3">
                <div class="micro-prop" style="transform: scaleX(-1)"></div>
                <div class="bar-track">
                    <div class="bar-fill"></div>
                    <span class="motor-id">M3</span>
                </div>
                <div class="pwm-val">1000</div>
            </div>
            <div class="motor-col" id="m4">
                <div class="micro-prop"></div>
                <div class="bar-track">
                    <div class="bar-fill"></div>
                    <span class="motor-id">M4</span>
                </div>
                <div class="pwm-val">1000</div>
            </div>
        </div>
        
        <input type="range" class="demo-slider" id="throttle" min="0" max="100" value="0" disabled>
    </div>

    <script>
        // 简单的逻辑脚本
        let isArmed = false;
        let baseThrottle = 0;
        let time = 0;
        
        const widget = document.getElementById('widget');
        const badge = document.getElementById('badge');
        const slider = document.getElementById('throttle');
        const motors = [
            document.getElementById('m1'),
            document.getElementById('m2'),
            document.getElementById('m3'),
            document.getElementById('m4')
        ];

        function toggleArm() {
            isArmed = !isArmed;
            if(isArmed) {
                widget.classList.add('armed');
                badge.innerText = "ARMED";
                slider.disabled = false;
            } else {
                widget.classList.remove('armed');
                badge.innerText = "DISARMED";
                slider.disabled = true;
                slider.value = 0;
                baseThrottle = 0;
            }
        }

        slider.addEventListener('input', e => baseThrottle = parseInt(e.target.value));

        function loop() {
            time += 0.2;
            motors.forEach((m, i) => {
                const fill = m.querySelector('.bar-fill');
                const val = m.querySelector('.pwm-val');
                const prop = m.querySelector('.micro-prop');
                
                let pct = 0;
                if(isArmed) {
                    let noise = Math.sin(time + i) * 3 + Math.random() * 2;
                    pct = Math.max(5, Math.min(100, 5 + baseThrottle + noise));
                    m.classList.add('spinning');
                    prop.style.animationDuration = Math.max(0.1, 0.4 - (pct/300)) + 's';
                } else {
                    m.classList.remove('spinning');
                }

                fill.style.height = pct + '%';
                // 颜色逻辑：蓝 -> 红
                if(pct < 50) {
                    fill.style.backgroundColor = `hsl(${210 + (pct/50)*50}, 90%, 60%)`;
                } else {
                    fill.style.backgroundColor = `hsl(${260 + ((pct-50)/50)*100}, 90%, 60%)`;
                }
                
                val.innerText = 1000 + Math.floor(pct * 10);
            });
            requestAnimationFrame(loop);
        }
        loop();
    </script>
</body>
</html>