# 项目代码书写规范（简版）

## 结构与职责
- `html/index.html` 只负责布局挂载和脚本、样式引入。不要在其中写内联业务逻辑，事件绑定放到对应 JS 模块。
- 样式拆分：
  - `styles/layout.css`：全局框架/导航/布局、控制台等。
  - `styles/new-ui.css`：组件级样式（遥测卡片、RC 监视器、IMU 卡片、弹窗、toast 等）。
  - `styles/main.css`：校准、通用按钮与调试面板样式。
- JS 模块职责清晰：
  - `app.js`：入口/生命周期，事件绑定、串口连接切换、调用 UI/Scene。
  - `serial.js`：串口读写与数据解析；通过 `onDataUpdate`、`onLine` 回调向上游推送。
  - `ui-*.js`：只操作各自 DOM，提供 `update(...)` 等公共方法。
  - `scene.js` + `drone.js`：3D 场景与模型。
  - 弹窗/流程逻辑放独立文件（如 `motor-modal.js`），避免跨文件直接改 DOM。

## 事件绑定
- 统一在各模块的初始化/`bindEvents` 中一次性绑定，避免重复绑定造成多次触发。
- 不在 HTML 上写行内事件，若已有兼容按钮，尽量在 JS 中重新绑定再移除行内写法。
- 共享事件通过全局函数暴露（`window.startMotorFlow` 等）要保持命名唯一、职责单一。

## DOM/样式约定
- 使用明确的 id/class，组件内部用局部查询，避免跨组件查询无关 DOM。
- 按需创建/销毁节点，toast、日志等需要队列上限（当前 toast 容器上限 5 条）。
- 布局/组件样式放 `layout.css` 或 `new-ui.css`，不要在 JS 里写行内样式，除非是实时值（translate/width）。

## 数据与状态
- 串口数据结构统一在 `serial.js` 内维护，新增字段在 `sensorData` 中声明默认值。
- `UIManager` 只调用各组件的公开方法，不直接操控子组件 DOM。
- 需要全局状态的场景（如 ARM 状态、录制状态）通过组件对外方法/标记传递，避免魔法常量。

## 交互流程示例
- 串口：`connectBtn` 切换连接/断开，断开后应重置 `port/reader` 为 null。
- 电机测试：`startMotorFlow` -> 安全确认 -> 测试弹窗；ARM 置位则拦截并提示。
- 日志/控制台：遵守节流开关，保持自动滚动开关可配置。

## 提交/格式
- 保持文件 ASCII，避免添加非必要的全局样式或内联脚本。
- 新增模块请在 `index.html` 中明确引入；新样式遵守现有分层。
- 变量/函数命名使用小驼峰；常量全大写；中文文案统一放在 HTML/配置，JS 只传递字符串。
